<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>单页面应用docker&#43;nginx部署 - 卡里的技术博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Carri" /><meta name="description" content="单页面应用docker&#43;nginx部署" />
<meta name="keywords" content="docker, nginx" />







<meta name="generator" content="Hugo 0.105.0" />


<link rel="canonical" href="http://gaocarri.top/post/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8docker&#43;nginx%E9%83%A8%E7%BD%B2/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa3d941d1d0e0ddc985804227feabffea55c89883eb0af34e0532a7ae9135151.css" integrity="sha256-&#43;j2UHR0ODdyYWAQif&#43;q//qVciYg&#43;sK804FMqeukTUVE=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="单页面应用docker&#43;nginx部署" />
<meta property="og:description" content="单页面应用docker&#43;nginx部署" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gaocarri.top/post/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8docker&#43;nginx%E9%83%A8%E7%BD%B2/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-08-27T00:00:00+00:00" />

<meta itemprop="name" content="单页面应用docker&#43;nginx部署">
<meta itemprop="description" content="单页面应用docker&#43;nginx部署"><meta itemprop="datePublished" content="2022-08-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-08-27T00:00:00+00:00" />
<meta itemprop="wordCount" content="2651">
<meta itemprop="keywords" content="Web工具," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="单页面应用docker&#43;nginx部署"/>
<meta name="twitter:description" content="单页面应用docker&#43;nginx部署"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-154009244-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">卡里的技术博客</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/post/">文章</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/%E5%85%B3%E4%BA%8E%E6%88%91/">关于我</a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = '015885799274435903025:9g3qczbcvxd';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      卡里的技术博客
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/post/">文章</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://gaocarri.top/%E5%85%B3%E4%BA%8E%E6%88%91/">关于我</a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight wallpaper">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">单页面应用docker&#43;nginx部署</h1>
      

      <div class="post-meta">
  <div class="post-meta-author">
    by
      Carri
    
  </div>

  <div class="post-meta-time">
    <time datetime="2022-08-27">
      2022-08-27
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 2651 字 -
        预计阅读 6 分钟
      </span>

    <div class="post-meta-category">
        <a href="http://gaocarri.top/categories/web%E5%B7%A5%E5%85%B7/"> Web工具 </a>
          
      </div>


    
    
      <span id="busuanzi_container_page_pv">
        | 阅读 <span id="busuanzi_value_page_pv"></span>
      </span>
    


    
    
  </div>
</div>

    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#nginx配置">nginx配置</a></li>
    <li><a href="#dockerfile编写">Dockerfile编写</a></li>
    <li><a href="#gitlab-ci配置">Gitlab CI配置</a></li>
    <li><a href="#镜像的部署">镜像的部署</a></li>
  </ul>
</nav>
  </div>
</div>


    
    <div class="post-content">
      <p>在公司实践了不少docker项目，总结了一套docker+nginx部署方案，以防忘记，为后续作参考。</p>
<h1 id="docker镜像构建">Docker镜像构建</h1>
<p>包含nginx配置、Dockerfile编写、Gitlab CI配置</p>
<h2 id="nginx配置">nginx配置</h2>
<p>后台项目不涉及服务端，ssr，不需要node环境，直接使用nginx即可，为了方便更改nginx的配置文件，在项目目录下建立一个nginx.conf文件，这里建立在根目录的config目录下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">touch config/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>1.nginx.conf编写
由于我们部署的项目并不是直接被用户访问到（会经由公司的服务器代理转发或者负载均衡），所以请按以下配置，否则可能会有奇怪的问题（http2问题）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>  <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 开启gzip----------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># 打开gzip
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 设置用于处理请求压缩的缓冲区数量和大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_buffers</span> <span class="mi">4</span> <span class="mi">16k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 当返回内容大于此值时才会使用gzip进行压缩
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_min_length</span> <span class="mi">10k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 设置gzip压缩级别，数字越大级别越高，但会提高服务器的CPU资源消耗
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_comp_level</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 一定要设置！，因为内外网进行了反向代理到该服务上，server之间默认时使用HTTP/1.0协议通信，gzip默认是1.1！！
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 增加响应头，告诉接收方经过了压缩处理，对于本身不支持gzip压缩的浏览器有用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_vary</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 设置需要压缩的类型，不要压缩图片!!压缩图片太消耗CPU资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">gzip_types</span> <span class="s">text/plain</span> <span class="s">text/css</span> <span class="s">application/json</span> <span class="s">application/javascript</span> <span class="s">application/x-javascript</span> <span class="s">text/xml</span> <span class="s">application/xml</span> <span class="s">application/xml+rss</span> <span class="s">text/javascript</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># ------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 日志--------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">access_log</span> <span class="s">/var/log/nginx/nginx-access.log</span> <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">error_log</span> <span class="s">/var/log/nginx/nginx-error.log</span> <span class="s">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">open_log_file_cache</span> <span class="s">max=1000</span> <span class="s">inactive=20s</span> <span class="s">valid=1m</span> <span class="s">min_uses=2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 后台项目都是单页面应用，只需设置 /
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># history路由需要开启，否则刷新页面时nginx无法找到资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span> <span class="s">/index.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 设置浏览器缓存----------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1"># 默认情况下nginx的响应头中会带有ETag、Last-modified的协商缓存字段，但无强缓存，所以需要自己设置强缓存cache-control（优先使用cahe-control，不要使用expires，max-age单位s）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1"># 不能设置private，否则不能被服务器缓存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|mp4|ogg|ogv|webm|htc)</span>$ <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">&#34;public,max-age=31536000&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:css|js)</span>$ <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">&#34;public,max-age=2592000&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 如果需要代理其他文件目录（如微前端）可以参考如下配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># location /subapp {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#     alias /usr/share/nginx/subapp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#     try_files $uri $uri/ /index.html;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#     index index.html index.htm;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dockerfile编写">Dockerfile编写</h2>
<p>Dockerfile用于定制镜像，Dockerfile概念可参考<a href="https://yeasy.gitbook.io/docker_practice/image/build">使用Dockerfile定制镜像</a></p>
<ol>
<li>在项目根目录建立文件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">touch Dockerfile <span class="c1"># docker build默认使用的配置</span>
</span></span><span class="line"><span class="cl">touch Dockerfile.dev <span class="c1"># 用于区分dev环境，docker build -f Dockerfile.dev运行</span>
</span></span><span class="line"><span class="cl">touch dockerignore <span class="c1"># 用于docker构建上下文时忽略掉.dockerignore里面的文件列表</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Dockerfile及Dockerfile.dev编写</li>
</ol>
<ul>
<li>Dockerfile</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:12-alpine as node</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./package.json ./yarn.lock /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 利用node_modules缓存</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 正式环境打包</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn build<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># alpine是一个精简的docker镜像，具有最少的软件包，但足以运行节点应用程序。</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:alpine</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">TZ</span><span class="o">=</span><span class="s2">&#34;Asia/Shanghai&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 拷贝dist文件</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>node /app/dist /usr/share/nginx/html<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 拷贝nginx配置</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>node /app/config/nginx.conf /etc/nginx/conf.d/default.conf<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Dockerfile.dev(用于工作时的内网环境)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:12-alpine as node</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./package.json ./yarn.lock /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 利用node_modules缓存</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># develop环境打包</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn build-dev<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># alpine是一个精简的docker镜像，具有最少的软件包，但足以运行节点应用程序。</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:alpine</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">TZ</span><span class="o">=</span><span class="s2">&#34;Asia/Shanghai&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 拷贝dist文件</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>node /app/dist /usr/share/nginx/html<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 拷贝nginx配置</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>node /app/config/nginx.conf /etc/nginx/conf.d/default.conf<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>dockerignore
dockerignore的配置也可以和.gitignore保持一致，可以排除掉不需要参与打包的文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">logs/
</span></span><span class="line"><span class="cl">npm-debug.log
</span></span><span class="line"><span class="cl">yarn-error.log
</span></span><span class="line"><span class="cl">node_modules/
</span></span><span class="line"><span class="cl">coverage/
</span></span><span class="line"><span class="cl">dist/
</span></span><span class="line"><span class="cl">.idea/
</span></span><span class="line"><span class="cl">run/
</span></span><span class="line"><span class="cl">.DS_Store
</span></span><span class="line"><span class="cl">*.sw*
</span></span><span class="line"><span class="cl">*.un~
</span></span><span class="line"><span class="cl">.tsbuildinfo
</span></span><span class="line"><span class="cl">.tsbuildinfo.*
</span></span><span class="line"><span class="cl">READEME.m
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>优化点
原先我们的项目拷贝目录的操作</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">COPY</span> . /app<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn <span class="p">&amp;</span> yarn build<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>优化后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">COPY</span> ./package.json ./yarn.lock /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 利用node_modules缓存</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . /app/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn build<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>为什么这么做？为了利用node_modules的缓存，如果一开始拷贝整个项目，runner就会认为这一步的文件改变了，就不会去用缓存，如果先拷贝的package.json和yarn.lock未改变，则会使用之前构建的镜象的这一层去使用缓存</p>
<ul>
<li>
<p>使用缓存时，yarn命令秒结束
<img src="/images/docker+nginx1.png" alt="docker+nginx1"></p>
</li>
<li>
<p>未使用缓存时,yarn命令持续安装
<img src="/images/docker+nginx2.png" alt="docker+nginx2"></p>
</li>
</ul>
<p>改写这一步能节省掉安装依赖的速度，并且不需要在构建时一并放入node_modules，减小了体积</p>
<p>关于打版本号改变了package.json导致无法使用缓存的问题，可以通过脚本拷贝一个不带version的package.json，然后利用缓存</p>
<h2 id="gitlab-ci配置">Gitlab CI配置</h2>
<p>git push=&gt;触发 CI=&gt;执行gitlab-ci.yml</p>
<p>Gitlab CI的配置需要在项目中编写.gitlab-ci.yml文件和在gitlab仓库设置CI/CD的变量</p>
<ol>
<li>.gitlab-ci.yml</li>
</ol>
<p>在项目根目录创建</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">touch .gitlab-ci.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">image: 这里需要一个基础的系统，如debian
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">stages:
</span></span><span class="line"><span class="cl">    - build_develop
</span></span><span class="line"><span class="cl">    - build_release
</span></span><span class="line"><span class="cl">    - build_branch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">variables:
</span></span><span class="line"><span class="cl">    DOCKER_REGISTRY_DEV: xxx.dev.com # 推送到内网仓库
</span></span><span class="line"><span class="cl">    DOCKER_REGISTRY: xxx.dev.com # 推送到外网仓库
</span></span><span class="line"><span class="cl">    DOCKER_REPO: frontend/xxx # 镜像仓库目录
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">before_script:
</span></span><span class="line"><span class="cl">    # 输出当前所有环境变量
</span></span><span class="line"><span class="cl">    - env
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">build_develop:
</span></span><span class="line"><span class="cl">    tags:
</span></span><span class="line"><span class="cl">        - docker # 使用tag为docker的runner触发构建
</span></span><span class="line"><span class="cl">    # execute shell command only git tag operation
</span></span><span class="line"><span class="cl">    only:
</span></span><span class="line"><span class="cl">        - develop # 只有推送 时才触发该job
</span></span><span class="line"><span class="cl">    stage: build_develop
</span></span><span class="line"><span class="cl">    script:
</span></span><span class="line"><span class="cl">        - image=${DOCKER_REGISTRY_DEV}/$DOCKER_REPO:latest
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # login to dockerhub
</span></span><span class="line"><span class="cl">        - docker login -u $NCR_DEV_USER -p $NCR_DEV_TOKEN $DOCKER_REGISTRY_DEV
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # build docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker build -t $image&#34;
</span></span><span class="line"><span class="cl">        - docker build -f Dockerfile.dev -t $image .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # push docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker push $image&#34;
</span></span><span class="line"><span class="cl">        - docker push $image
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # logout dockerhub
</span></span><span class="line"><span class="cl">        - docker logout $DOCKER_REGISTRY_DEV
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">build_release:
</span></span><span class="line"><span class="cl">    tags:
</span></span><span class="line"><span class="cl">        - docker # 使用tag为docker的runner触发构建
</span></span><span class="line"><span class="cl">    # execute shell command only git tag operation
</span></span><span class="line"><span class="cl">    only:
</span></span><span class="line"><span class="cl">        - tags # 只有推送tag时才触发该job
</span></span><span class="line"><span class="cl">    stage: build_release
</span></span><span class="line"><span class="cl">    script:
</span></span><span class="line"><span class="cl">        # use git tag name as docker build image name
</span></span><span class="line"><span class="cl">        - TAG=${CI_BUILD_TAG} # 默认使用当前推送的tag名作为镜像tag，可修改为下面的commit hash的前六位等
</span></span><span class="line"><span class="cl">        # use current git commit hash as build image name
</span></span><span class="line"><span class="cl">        # - TAG=${CI_BUILD_REF:0:6}
</span></span><span class="line"><span class="cl">        - image=${DOCKER_REGISTRY}/$DOCKER_REPO:latest
</span></span><span class="line"><span class="cl">        - image_with_tag=${DOCKER_REGISTRY}/$DOCKER_REPO:$TAG
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # login to dockerhub
</span></span><span class="line"><span class="cl">        - docker login -u $NCR_USER -p $NCR_TOKEN $DOCKER_REGISTRY
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # build docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker build -t $image&#34;
</span></span><span class="line"><span class="cl">        - docker build -t $image -t $image_with_tag .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # push docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker push $image&#34;
</span></span><span class="line"><span class="cl">        - docker push $image
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # push docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker push $image_with_tag&#34;
</span></span><span class="line"><span class="cl">        - docker push $image_with_tag
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # logout dockerhub
</span></span><span class="line"><span class="cl">        - docker logout $DOCKER_REGISTRY
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">build_branch:
</span></span><span class="line"><span class="cl">    tags:
</span></span><span class="line"><span class="cl">        - docker
</span></span><span class="line"><span class="cl">    except:
</span></span><span class="line"><span class="cl">        - develop
</span></span><span class="line"><span class="cl">        - tags
</span></span><span class="line"><span class="cl">        - master
</span></span><span class="line"><span class="cl">    stage: build_branch
</span></span><span class="line"><span class="cl">    script:
</span></span><span class="line"><span class="cl">        - TAG=`echo ${CI_BUILD_REF_NAME} | tr &#34;/&#34; &#34;-&#34;`
</span></span><span class="line"><span class="cl">        - image=${DOCKER_REGISTRY_DEV}/${DOCKER_REPO}:${TAG
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # login to dockerhub
</span></span><span class="line"><span class="cl">        - docker login -u ${NCR_DEV_USER} -p ${NCR_DEV_TOKEN} ${DOCKER_REGISTRY_DEV}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # build docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker build -t ${image}&#34;
</span></span><span class="line"><span class="cl">        - docker build -f Dockerfile.dev -t ${image} .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # push docker image
</span></span><span class="line"><span class="cl">        - echo &#34;$ docker push ${image}&#34;
</span></span><span class="line"><span class="cl">        - docker push ${image}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # logout dockerhub
</span></span><span class="line"><span class="cl">        - docker logout ${DOCKER_REGISTRY_DEV}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>配置gitlab仓库
需配置变量
<img src="/images/docker+nginx3.png" alt="docker+nginx3"></li>
</ol>
<h2 id="镜像的部署">镜像的部署</h2>
<p>初次部署要手动启用一个docker镜像</p>
<ol>
<li>拉取镜像</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull 镜像名
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>查看镜像id</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker image ls
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>启动容器</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run --name 去一个名字 -d -p 82:80 镜像id
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>查看容器启动情况，第一个就是刚才启动的容器</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker ps
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="参考文献">参考文献</h1>
<ol>
<li><a href="https://yeasy.gitbook.io/docker_practice/">docker从入门到实践</a></li>
<li><a href="https://juejin.cn/post/6844904129987526663">连前端都看得懂的《Nginx入门指南》</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/44789005">一文读懂前端缓存</a></li>
</ol>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Carri</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-08-27
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>



    
    


    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://gaocarri.top/tags/web%E5%B7%A5%E5%85%B7/">Web工具</a>
            
        </div>


      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/qiankun%E7%9A%84js%E6%B2%99%E7%AE%B1%E8%AF%A6%E8%A7%A3/">
            <span class="next-text nav-default">qiankun的js沙箱源码解析</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
    
  


  
  

  

  
  

  
  
    <div class="post bg-white">
  <script src="https://utteranc.es/client.js"
        repo= "gaocarri/comments-for-blog"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</div>

  

  

  

    

  

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:gaocarri@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/Gaocarri" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://space.bilibili.com/1762142" rel="me noopener" class="iconfont"
      title="bilibili"  target="_blank"
      >
      <svg
  class="icon" style="" viewBox="0 0 1024 1024" version="1.1" width="36"
  height="36" id="svg8">
  <path
      style=""
      d="M 744.60599,0.00486267 A 41.779915,41.779915 0 0 0 710.4184,18.673394 L 548.5048,255.32642 h -11.70046 a 41.779915,41.779915 0 0 0 -10.80295,-7.84928 L 235.66,97.084498 a 41.779915,41.779915 0 0 0 -20.07193,-4.960864 41.779915,41.779915 0 0 0 -18.3748,79.145436 L 359.4859,255.32642 H 128.16909 c -49.458302,0 -89.27932,39.82105 -89.27932,89.27932 v 508.65224 c 0,49.4583 39.821018,89.27934 89.27932,89.27934 h 19.48445 C 149.12802,984.5043 179.92773,1024 224.79179,1024 c 44.86407,0 75.66379,-39.4957 77.13826,-81.46268 H 719.98116 C 721.45559,984.5043 752.25533,1024 797.1194,1024 c 44.86406,0 75.6638,-39.4957 77.13824,-81.46268 h 21.57323 c 49.45831,0 89.27936,-39.82104 89.27936,-89.27934 V 344.60574 c 0,-49.45827 -39.82105,-89.27932 -89.27936,-89.27932 H 649.74567 L 779.38103,65.866924 A 41.779915,41.779915 0 0 0 744.60599,0.00486267 Z M 644.49108,418.70871 c 6.29985,0.21538 12.44451,2.01107 17.86888,5.22196 l 171.36218,98.10771 c 18.23417,10.21935 24.63334,33.34627 14.24614,51.48533 -10.38726,18.13909 -33.57344,24.32718 -51.61587,13.77296 L 624.9903,489.18895 c -15.21356,-8.41858 -22.66871,-26.1765 -18.03211,-42.93436 4.63664,-16.75784 20.15573,-28.14465 37.53289,-27.54588 z M 350.2006,432.31846 c 16.89952,0.0317 31.69582,11.33328 36.17844,27.62747 4.48262,16.2942 -2.44981,33.57765 -16.95507,42.24898 l -140.7157,86.91312 c -17.68528,11.18244 -41.09629,5.77692 -52.08912,-12.02686 -10.99282,-17.80373 -5.33855,-41.15658 12.58167,-51.95857 L 329.9002,438.2095 c 6.0643,-3.86439 13.10951,-5.90891 20.3004,-5.89104 z M 501.605,641.53985 c 3.75002,-0.15248 7.48645,0.53903 10.93349,2.0235 0.15842,0.0637 0.31618,0.12888 0.47325,0.19582 0.59328,0.27092 1.17574,0.56489 1.74609,0.88121 0.15868,0.0854 0.31643,0.17233 0.47325,0.2611 0.55694,0.32165 1.10131,0.66458 1.63185,1.02807 0.16455,0.1123 0.32777,0.2265 0.48956,0.34269 0.50382,0.36781 0.99371,0.75428 1.46868,1.15864 0.18724,0.15504 0.37218,0.31282 0.55484,0.47323 0.43271,0.38784 0.8518,0.79061 1.25653,1.20756 0.15449,0.16114 0.30679,0.32437 0.45693,0.48959 0.40798,0.44266 0.79989,0.89988 1.17494,1.37076 0.17799,0.22544 0.35205,0.45395 0.5222,0.68538 0.25932,0.34701 0.50964,0.70071 0.75064,1.06071 0.26712,0.39516 0.52286,0.79784 0.76699,1.20757 0.16907,0.29043 0.33231,0.58424 0.48957,0.88123 0.21836,0.41297 0.42513,0.83199 0.62009,1.25653 0.14836,0.32333 0.28983,0.64976 0.42429,0.97911 0.21319,0.51552 0.40915,1.03801 0.58747,1.5666 0.0677,0.19499 0.13296,0.39085 0.19582,0.58748 0.18652,0.60823 0.34984,1.22334 0.48957,1.84399 0.0397,0.16277 0.0779,0.32601 0.11423,0.48957 0.1436,0.69112 0.25788,1.38801 0.34269,2.08877 0.005,0.0381 0.0111,0.0761 0.0163,0.11424 0.0857,0.78056 0.13474,1.56471 0.14687,2.34988 0.005,0.0543 0.0111,0.10879 0.0163,0.1632 0,0 -0.008,1.12132 0,1.45234 0,0 -0.14697,17.84761 5.89102,34.12231 3.01902,8.13734 7.33278,15.10615 12.61433,19.61501 5.28157,4.50889 11.42894,7.62081 23.64572,7.62081 12.2168,0 18.36416,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.5953,-11.47767 12.6143,-19.61501 6.03799,-16.2747 5.89103,-34.12231 5.89103,-34.12231 -0.44885,-13.87045 10.45922,-25.46302 24.3311,-25.86506 13.87189,-0.40201 25.42828,10.53953 25.78348,24.41272 0,0 1.11929,25.7226 -9.00791,53.01927 -5.06359,13.64832 -13.1986,28.46036 -27.05631,40.29073 -13.85772,11.83039 -33.5454,19.63135 -56.20142,19.63135 -22.65603,0 -42.34371,-7.80096 -56.20141,-19.63135 -4.1801,-3.56856 -7.78733,-7.42433 -10.99878,-11.42303 -3.21235,4.00037 -6.81703,7.85309 -10.99876,11.42303 -13.85773,11.83039 -33.5454,19.63135 -56.20144,19.63135 -22.65601,0 -42.3437,-7.80096 -56.2014,-19.63135 -13.85775,-11.83037 -21.99272,-26.64241 -27.05632,-40.29073 -10.12725,-27.29667 -9.00789,-53.01928 -9.00789,-53.01927 0.20714,-13.83687 11.58744,-24.88848 25.42444,-24.69013 14.1263,0.19991 25.2971,12.0278 24.69011,26.14247 0,0 -0.14697,17.84761 5.89103,34.12231 3.01902,8.13734 7.31646,15.10615 12.598,19.61501 5.28155,4.50889 11.44526,7.62081 23.66203,7.62081 12.21681,0 18.36418,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.57899,-11.47767 12.598,-19.61501 5.76352,-15.53489 5.89112,-32.05691 5.89103,-33.56746 0.006,-0.37466 0.0111,-1.05336 0.0163,-1.20759 -0.0117,-0.74583 0.0105,-1.49177 0.0652,-2.23565 0.009,-0.15784 0.0204,-0.31561 0.0327,-0.47324 0.14204,-1.56859 0.43163,-3.12027 0.86487,-4.63449 0.0213,-0.0763 0.0433,-0.15244 0.0652,-0.22848 3.0335,-10.25748 12.24157,-17.46007 22.92769,-17.93417 z"
      id="rect824"/>
</svg>

    </a>


<a href="http://gaocarri.top/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Carri
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.0ad349017808f9c3192b88ad05faf786650358631fca9cd1416cbfa088cdf915.js" integrity="sha256-CtNJAXgI&#43;cMZK4itBfr3hmUDWGMfypzRQWy/oIjN&#43;RU=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>










  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
